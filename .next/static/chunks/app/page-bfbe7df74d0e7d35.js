(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{43:function(e,t,s){Promise.resolve().then(s.bind(s,180)),Promise.resolve().then(s.bind(s,9073))},180:function(e,t,s){"use strict";s.r(t),s.d(t,{Calendar:function(){return M}});var a=s(7437),r=s(2265),n=s(5754),i=s(7815),l=s(6308),d=s(6918),o=s(2232),c=s(2339),m=s(8124),u=s(9433),x=s(4298),p=s(7339),g=s(7951),f=s(3544),h=s(1291),b=s(7158),j=s(6141),y=s(2749),N=s(8712),v=s(2549),w=s(1657);let k=N.fC;N.xz;let S=N.h_;N.x8;let C=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(N.aV,{ref:t,className:(0,w.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});C.displayName=N.aV.displayName;let T=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(S,{children:[(0,a.jsx)(C,{}),(0,a.jsxs)(N.VY,{ref:t,className:(0,w.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[r,(0,a.jsxs)(N.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});T.displayName=N.VY.displayName;let D=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,w.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};D.displayName="DialogHeader";let E=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,w.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};E.displayName="DialogFooter";let _=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(N.Dx,{ref:t,className:(0,w.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});_.displayName=N.Dx.displayName;let q=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(N.dk,{ref:t,className:(0,w.cn)("text-sm text-muted-foreground",s),...r})});q.displayName=N.dk.displayName;var z=s(5179),I=s(9842),O=s(3444),R=s(7788);function P(e){let{equipment:t,selectedDate:s,open:i,onOpenChange:l,onBookingCreated:d}=e,{data:o}=(0,y.useSession)(),[c,m]=(0,r.useState)("09:00"),[u,p]=(0,r.useState)("10:00"),[g,h]=(0,r.useState)(""),[b,j]=(0,r.useState)(""),[N,v]=(0,r.useState)(""),[w,S]=(0,r.useState)(!1),{toast:C}=(0,R.pm)(),P=async e=>{e.preventDefault(),S(!0);try{let e=new Date(s),a=new Date(s),[r,n]=c.split(":").map(Number),[i,l]=u.split(":").map(Number);if(e.setHours(r,n,0,0),a.setHours(i,l,0,0),e>=a){C({title:"時間錯誤",description:"結束時間必須晚於開始時間",variant:"destructive"});return}if(!o&&(!b||!N)){C({title:"資訊不完整",description:"請填寫您的姓名和聯絡信箱",variant:"destructive"});return}let m=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({equipmentId:t.id,startTime:e.toISOString(),endTime:a.toISOString(),purpose:g,guestName:o?void 0:b,guestEmail:o?void 0:N})});if(m.ok)C({title:"預約成功",description:"您的預約申請已提交，等待管理員審核"}),d();else{let e=await m.json();C({title:"預約失敗",description:e.error||"發生未知錯誤",variant:"destructive"})}}catch(e){console.error("預約失敗:",e),C({title:"預約失敗",description:"發生網路錯誤，請重試",variant:"destructive"})}finally{S(!1)}};return(0,a.jsx)(k,{open:i,onOpenChange:l,children:(0,a.jsxs)(T,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(D,{children:[(0,a.jsx)(_,{children:"預約設備"}),(0,a.jsxs)(q,{children:["預約 ",t.name," - ",(0,x.WU)(s,"yyyy年MM月dd日",{locale:f.c})]})]}),(0,a.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(I._,{htmlFor:"startTime",children:"開始時間"}),(0,a.jsx)(z.I,{id:"startTime",type:"time",value:c,onChange:e=>m(e.target.value),min:"09:00",max:"18:00",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(I._,{htmlFor:"endTime",children:"結束時間"}),(0,a.jsx)(z.I,{id:"endTime",type:"time",value:u,onChange:e=>p(e.target.value),min:"09:00",max:"18:00",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(I._,{htmlFor:"purpose",children:"使用目的"}),(0,a.jsx)(O.g,{id:"purpose",placeholder:"請說明使用設備的目的和實驗內容...",value:g,onChange:e=>h(e.target.value),required:!0,rows:3})]}),!o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(I._,{htmlFor:"guestName",children:"姓名"}),(0,a.jsx)(z.I,{id:"guestName",type:"text",placeholder:"請輸入您的姓名",value:b,onChange:e=>j(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(I._,{htmlFor:"guestEmail",children:"聯絡信箱"}),(0,a.jsx)(z.I,{id:"guestEmail",type:"email",placeholder:"請輸入您的聯絡信箱",value:N,onChange:e=>v(e.target.value),required:!0})]})]}),(0,a.jsxs)(E,{children:[(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>l(!1),children:"取消"}),(0,a.jsx)(n.z,{type:"submit",disabled:w,children:w?"提交中...":"提交預約"})]})]})]})})}let F={"cryo-1":"bg-blue-500","cryo-2":"bg-green-500","cryo-3":"bg-purple-500","cryo-4":"bg-orange-500"},H={"cryo-1":"bg-blue-100 text-blue-800 border-blue-200","cryo-2":"bg-green-100 text-green-800 border-green-200","cryo-3":"bg-purple-100 text-purple-800 border-purple-200","cryo-4":"bg-orange-100 text-orange-800 border-orange-200"};function V(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(t?H:F)[e]||(t?"bg-gray-100 text-gray-800 border-gray-200":"bg-gray-500")}function M(){let[e,t]=(0,r.useState)(new Date),[s,y]=(0,r.useState)(null),[N,v]=(0,r.useState)([]),[k,S]=(0,r.useState)([]),[C,T]=(0,r.useState)(null),[D,E]=(0,r.useState)(!1);(0,r.useEffect)(()=>{_(),q()},[e]);let _=async()=>{try{let e=await fetch("/api/equipment");if(e.ok){let t=await e.json();v(t)}}catch(e){console.error("取得設備列表失敗:",e)}},q=async()=>{try{let e=await fetch("/api/bookings");if(e.ok){let t=(await e.json()).map(e=>({...e,startTime:new Date(e.startTime),endTime:new Date(e.endTime)}));S(t)}}catch(e){console.error("取得預約列表失敗:",e)}},z=(0,l.N)(e),I=(0,d.V)(e),O=(0,o.D)({start:z,end:I}),R=e=>k.filter(t=>(0,c.K)(t.startTime,e)||t.startTime<=e&&t.endTime>=e),F=e=>{y(e)},H=e=>{T(e),E(!0)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(n.z,{variant:"outline",onClick:()=>{t((0,m.W)(e,1))},children:(0,a.jsx)(h.Z,{className:"h-4 w-4"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold",children:(0,x.WU)(e,"yyyy年 MMMM",{locale:f.c})}),(0,a.jsx)(n.z,{variant:"outline",onClick:()=>{t((0,u.z)(e,1))},children:(0,a.jsx)(b.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"設備圖例："}),N.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(V(e.id))}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:e.name})]},e.id)),(0,a.jsxs)("div",{className:"ml-4 flex items-center gap-4 text-xs text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-green-600",children:"●"})," 已核准"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-orange-600",children:"●"})," 待審核"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"text-red-600",children:"●"})," 已拒絕"]})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:N.map(e=>(0,a.jsx)(i.Zb,{className:"cursor-pointer transition-colors hover:bg-gray-50 ".concat((null==C?void 0:C.id)===e.id?"ring-2 ring-blue-500":""),onClick:()=>H(e),children:(0,a.jsxs)(i.aY,{className:"p-4",children:[(0,a.jsx)("h3",{className:"font-medium",children:e.name}),e.location&&(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.location})]})},e.id))}),(0,a.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[["日","一","二","三","四","五","六"].map(e=>(0,a.jsx)("div",{className:"p-2 text-center font-medium text-gray-500",children:e},e)),O.map(t=>{let r=R(t),n=s&&(0,c.K)(t,s),i=(0,p.x)(t,e),l=!(0,w.cQ)(t);return(0,a.jsxs)("div",{className:"min-h-[100px] p-2 border cursor-pointer transition-colors ".concat(n?"bg-blue-100 border-blue-300":"border-gray-200"," ").concat((0,g.z)(t)?"bg-blue-50":""," ").concat(i?"":"text-gray-400 bg-gray-50"," ").concat(l?"bg-red-50 cursor-not-allowed":"hover:bg-gray-50"),onClick:()=>!l&&F(t),children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:(0,x.WU)(t,"d")}),(0,a.jsxs)("div",{className:"mt-1 space-y-1",children:[r.slice(0,3).map(e=>(0,a.jsxs)("div",{className:"text-xs p-1 rounded border ".concat(V(e.equipment.id,!0)," cursor-pointer hover:opacity-80"),title:"".concat(e.equipment.name," - ").concat((0,x.WU)(e.startTime,"HH:mm")," (").concat("APPROVED"===e.status?"已核准":"PENDING"===e.status?"待審核":"已拒絕",")"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-1 truncate",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(V(e.equipment.id))}),(0,a.jsx)("span",{className:"truncate font-medium",children:e.equipment.name})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs opacity-75",children:[(0,a.jsx)(j.Z,{className:"h-2.5 w-2.5"}),(0,x.WU)(e.startTime,"HH:mm"),"PENDING"===e.status&&(0,a.jsx)("span",{className:"text-orange-600",children:"●"}),"APPROVED"===e.status&&(0,a.jsx)("span",{className:"text-green-600",children:"●"}),"REJECTED"===e.status&&(0,a.jsx)("span",{className:"text-red-600",children:"●"})]})]},e.id)),r.length>3&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 p-1",children:["+",r.length-3," 更多預約"]})]}),l&&(0,a.jsx)("div",{className:"text-xs text-red-500 mt-1",children:"不開放"})]},t.toString())})]}),D&&C&&s&&(0,a.jsx)(P,{equipment:C,selectedDate:s,open:D,onOpenChange:E,onBookingCreated:()=>{q(),E(!1)}})]})}},5179:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var a=s(7437),r=s(2265),n=s(1657);let i=r.forwardRef((e,t)=>{let{className:s,type:r,...i}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...i})});i.displayName="Input"},9842:function(e,t,s){"use strict";s.d(t,{_:function(){return o}});var a=s(7437),r=s(2265),n=s(6743),i=s(6061),l=s(1657);let d=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.f,{ref:t,className:(0,l.cn)(d(),s),...r})});o.displayName=n.f.displayName},3444:function(e,t,s){"use strict";s.d(t,{g:function(){return i}});var a=s(7437),r=s(2265),n=s(1657);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r})});i.displayName="Textarea"}},function(e){e.O(0,[27,896,129,791,460,971,938,744],function(){return e(e.s=43)}),_N_E=e.O()}]);