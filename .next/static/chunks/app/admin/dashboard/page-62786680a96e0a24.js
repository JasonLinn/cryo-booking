(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[427],{6142:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(2898).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},2549:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(2898).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},8693:function(e,t,s){Promise.resolve().then(s.bind(s,5695)),Promise.resolve().then(s.bind(s,9073))},5695:function(e,t,s){"use strict";s.r(t),s.d(t,{BookingApprovalList:function(){return p}});var r=s(7437),a=s(2265),n=s(5754),i=s(1478),c=s(7815),l=s(3444),d=s(7788),o=s(1657),u=s(6141),m=s(7972),x=s(6142),f=s(2442),h=s(2549);function p(){let[e,t]=(0,a.useState)([]),[s,p]=(0,a.useState)(!0),[g,v]=(0,a.useState)(null),[j,b]=(0,a.useState)({}),{toast:y}=(0,d.pm)();(0,a.useEffect)(()=>{N()},[]);let N=async()=>{try{let e=await fetch("/api/bookings?status=PENDING");if(e.ok){let s=(await e.json()).map(e=>({...e,startTime:new Date(e.startTime),endTime:new Date(e.endTime),createdAt:new Date(e.createdAt)}));t(s)}}catch(e){console.error("取得預約列表失敗:",e),y({title:"載入失敗",description:"無法載入預約列表",variant:"destructive"})}finally{p(!1)}},w=async(e,s)=>{v(e);try{let r=await fetch("/api/bookings/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s,adminNotes:j[e]||""})});if(r.ok)y({title:"預約已".concat("APPROVED"===s?"核准":"拒絕"),description:"使用者將收到郵件通知"}),t(t=>t.filter(t=>t.id!==e)),b(t=>{let s={...t};return delete s[e],s});else{let e=await r.json();throw Error(e.error)}}catch(e){console.error("處理預約失敗:",e),y({title:"處理失敗",description:e instanceof Error?e.message:"發生未知錯誤",variant:"destructive"})}finally{v(null)}};return s?(0,r.jsx)("div",{className:"text-center py-8",children:"載入中..."}):0===e.length?(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"目前沒有待審核的預約申請"}):(0,r.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,r.jsxs)(c.Zb,{className:"border-l-4 border-l-orange-400",children:[(0,r.jsx)(c.Ol,{children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(c.ll,{className:"text-lg flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"h-5 w-5"}),e.equipment.name]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4"}),e.user.name||e.user.email]}),e.equipment.location&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(x.Z,{className:"h-4 w-4"}),e.equipment.location]})]})]}),(0,r.jsx)(i.C,{variant:"secondary",children:(0,o.o0)(e.createdAt)})]})}),(0,r.jsxs)(c.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:"使用時間"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,o.o0)(e.startTime)," - ",(0,o.o0)(e.endTime)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:"申請人資訊"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[e.user.email,e.user.department&&" (".concat(e.user.department,")")]})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900",children:"使用目的"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.purpose})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"管理員備註 (選填)"}),(0,r.jsx)(l.g,{placeholder:"請輸入審核備註...",value:j[e.id]||"",onChange:t=>b(s=>({...s,[e.id]:t.target.value})),rows:2})]}),(0,r.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,r.jsxs)(n.z,{onClick:()=>w(e.id,"APPROVED"),disabled:g===e.id,className:"flex items-center gap-2",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4"}),"核准"]}),(0,r.jsxs)(n.z,{variant:"destructive",onClick:()=>w(e.id,"REJECTED"),disabled:g===e.id,className:"flex items-center gap-2",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4"}),"拒絕"]})]})]})]},e.id))})}},1478:function(e,t,s){"use strict";s.d(t,{C:function(){return c}});var r=s(7437);s(2265);var a=s(6061),n=s(1657);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:s,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)(i({variant:s}),t),...a})}},3444:function(e,t,s){"use strict";s.d(t,{g:function(){return i}});var r=s(7437),a=s(2265),n=s(1657);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a})});i.displayName="Textarea"}},function(e){e.O(0,[27,896,129,460,971,938,744],function(){return e(e.s=8693)}),_N_E=e.O()}]);